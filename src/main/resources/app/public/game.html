<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="../style/fontStyle.css">
<link rel="stylesheet" type="text/css" href="../style/gameStyle.css">
<link rel="shortcut icon" href="../img/icon.png">
<title>Battleship</title>
</head>
<script src="https://cdnjs.cloudflare.com/ajax/libs/interact.js/1.2.5/interact.min.js"></script>
<script type="text/javascript" src="../lib/jquery-1.11.3.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.14/jquery-ui.min.js" type="text/javascript"></script>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/jquery-ui.min.js"></script>
<script>

//some function
function vWidth(clientwidth){
	var windowwidth = window.innerWidth;
	var width = (clientwidth*100)/windowwidth;
	return width; 
}

function vHeight(clientheight){
	var windowheight = window.innerHeight;
	var height = (clientheight*100)/windowheight;
	return height; 
}

//swipe + arrowkeys	
$(document).ready(function() {
	
	function swipeRight() 
	{
		jQuery('#left').animate({
				width:0,
				'left': '-30%',
				opacity:0
			},
			300
		).css('right','');
		jQuery('#right').animate({
				width:'100%',
				'left': '0%',
				opacity:1.0
			},
			400	
		).css('right','');
		jQuery('#right').toggleClass('active',true);
		jQuery('#left').toggleClass('active',false);
		jQuery('#rightarrow').hide();
		jQuery('#leftarrow').show();
		
	};
	function swipeLeft()
	{

		jQuery('#right').animate({
				width:0,
				'right': '-30%',
				opacity:0
			},
			400
		).css('left','');
		jQuery('#left').animate({
				width:'100%',
				'right': '0%',
				opacity:1.0
			},
			300	
		).css('left','');
		jQuery('#left').toggleClass('active',true);
		jQuery('#right').toggleClass('active',false);
		jQuery('#leftarrow').hide();
		jQuery('#rightarrow').show();
		
	};
	
	//Arrow management
	$('#rightarrow').on('click', function(e){
		swipeRight();
	});
	$('#leftarrow').on('click', function(e){
		swipeLeft();
	});
	//Keyboard navigation
	$("body").keydown(function( event ) {
  		if ( event.keyCode == 39 && $('#left').hasClass('active') ){
			swipeRight();		
  		}
		else if ( event.keyCode == 37 && $('#right').hasClass('active') ) {
			swipeLeft();		
  		}
	});
});


//Drag and drop stuff
function dragMoveListener (event) {
    var target = event.target,
        // keep the dragged position in the data-x/data-y attributes
        x = (parseFloat(target.getAttribute('data-x')) || 0) + event.dx,
        y = (parseFloat(target.getAttribute('data-y')) || 0) + event.dy;

    // translate the element
    target.style.webkitTransform =
    target.style.transform =
      'translate(' + vWidth(x) + 'vw, ' + vHeight(y) + 'vh) ';
		
		if(target.classList.contains('horizontal')){
			target.style.transform += 'rotate(-0deg)';
		} else 	if(target.classList.contains('vertical')){
			target.style.transform += 'rotate(-90deg)';
		}

    // update the posiion attributes
    target.setAttribute('data-x', x);
    target.setAttribute('data-y', y);

}  

interact('.draggable').draggable({
    // enable inertial throwing
  		inertia: true,
    // keep the element within the area of it's parent
  		restrict: {
      		restriction: ('#tableleft'),
      		endOnly: true,
	        elementRect: { top: 0, left: 0, bottom: 1, right: 1 }
    	},
		// call this function on every dragmove event
		onmove: dragMoveListener,
		//onstart: dragMoveListener,
		// call this function on every dragend event
		onend: function (event) {
		  console.log(event);
		}
	})
	.snap({
		  mode: 'anchor',
		  anchors: [],
		  range: Infinity,
		  elementOrigin: { x: 0.5, y: 0.5 },
		  endOnly: true
	})
	//Doubleclick change direction
	.on('doubletap', function (event) {
		if(event.currentTarget.classList.contains('horizontal')){
			event.currentTarget.classList.add('vertical');
			event.currentTarget.classList.remove('horizontal');
			event.currentTarget.style.transform += 'rotate(-90deg)';
		} else 	if(event.currentTarget.classList.contains('vertical')){
			event.currentTarget.classList.add('horizontal');
			event.currentTarget.classList.remove('vertical');
			event.currentTarget.style.transform += 'rotate(0deg)';
		}
		onmove(event);
	});
	
interact('.square').dropzone({
			accept : ".draggable",
			overlap: 'center',
			
			  // listen for drop related events:

			  ondropactivate: function (event) {
				// add active dropzone feedback
				event.target.classList.add('drop-active');
			  },
			  ondragenter: function (event) {
				var draggableElement = event.relatedTarget,
					dropzoneElement = event.target;
			
				// feedback the possibility of a drop
				dropzoneElement.classList.add('drop-target');
				draggableElement.classList.add('can-drop');
				
				var dropRect = interact.getElementRect(dropzoneElement);
				var dropLeft =0;
					if ($('#'+draggableElement.id).hasClass('odd')){
						dropLeft = {
						  x: dropRect.left + dropRect.width/2,
						  y: dropRect.top + dropRect.height/2
						};
					} else 	if ($('#'+draggableElement.id).hasClass('even')){
						if($('#'+draggableElement.id).hasClass('horizontal')){
							dropLeft = {
							  x: dropRect.left + dropRect.width,
							  y: dropRect.top + dropRect.height/2
							};
						} else if($('#'+draggableElement.id).hasClass('vertical')){
							dropLeft = {
							  x: dropRect.left + dropRect.width/2,
							  y: dropRect.top + dropRect.height
							};
						}
					}
					console.log(dropLeft);
			
				event.draggable.snap({
				  anchors: [ dropLeft ]
				});
			  },
			  ondragleave: function (event) {
				// remove the drop feedback style
				
				event.target.classList.remove('occupied');
				event.target.classList.remove('drop-target');
				event.relatedTarget.classList.remove('can-drop');
				event.draggable.snap(false);
			  },
			  ondrop: function (event) {
				  //relatedtarget = ship
				  //target = dropzone/square
				$('#'+event.relatedTarget.id).css('left',0).appendTo($('#'+event.target.id));
				
				// notify user with occupied cells
				if ($('#'+event.relatedTarget.id).hasClass('horizontal')){
					var length = Math.round(document.getElementById(event.relatedTarget.id).offsetWidth/document.getElementById(event.target.id).offsetWidth);
					var row= event.target.id.charAt(event.target.id.length-2);
					
					if ($('#'+event.relatedTarget.id).hasClass('odd')){
						var middledivnum = parseInt(event.target.id.slice(-1));
						var divoneachsidenum = (length-1)/2;
						console.log(divoneachsidenum + ' : divs on each side');
						
						var startingdivnum = middledivnum - divoneachsidenum;
						console.log(startingdivnum + ' : starting div num')
						
						var endingdivnum = middledivnum + divoneachsidenum;
						console.log(endingdivnum + 'ending div num')
						
						for(i=startingdivnum; i<endingdivnum+1; i++){
							var d = document.getElementById('lsquare'+row+i);
							d.classList.add('occupied');
							d.classList.add('by'+event.relatedTarget.id);
							console.log('lsquare'+row+i);
						}
					}
						if ($('#'+event.relatedTarget.id).hasClass('even')){
							
						//console.log('boat middle: ' + ((document.getElementById(event.relatedTarget.id).getBoundingClientRect().left+document.getElementById(event.relatedTarget.id).getBoundingClientRect().right)/2));
						//console.log('cell right: ' +document.getElementById(event.target.id).getBoundingClientRect().right);
						//console.log('cell left: ' +document.getElementById(event.target.id).getBoundingClientRect().left);
						
						var boatcenterx = (document.getElementById(event.relatedTarget.id).getBoundingClientRect().left+document.getElementById(event.relatedTarget.id).getBoundingClientRect().right)/2;
						var leftcellbound = document.getElementById(event.target.id).getBoundingClientRect().left;
						var rightcellbound = document.getElementById(event.target.id).getBoundingClientRect().right;
						
						if ( Math.round(boatcenterx) > (Math.round(rightcellbound)-2) && Math.round(boatcenterx) < (Math.round(rightcellbound)+2) ){
							var divsonrightside = ((length)/2);
							var divsonleftside = divsonrightside-1;	
						} else if ( Math.round(boatcenterx) > (Math.round(leftcellbound)-2) && Math.round(boatcenterx) < (Math.round(leftcellbound)+2)){
							var divsonleftside = ((length)/2);
							var divsonrightside = divsonleftside-1;	
						}
						
						var middledivnum = parseInt(event.target.id.slice(-1));
						//console.log(divsonrightside + ' : divs on right side');
						//console.log(divsonleftside + ' : divs on left side');
						
						var startingdivnum = middledivnum - divsonleftside;
						//console.log(startingdivnum + ' : starting div num');
						
						var endingdivnum = middledivnum + divsonrightside;
						//console.log(endingdivnum + 'ending div num')
						
						for(i=startingdivnum; i<endingdivnum+1; i++){
							var d = document.getElementById('lsquare'+row+i);
							d.classList.add('occupied');
							d.classList.add('by'+event.relatedTarget.id);
							//console.log('lsquare'+row+i);
						}
					}
				}	else if ($('#'+event.relatedTarget.id).hasClass('vertical')){
					var length = Math.round(document.getElementById(event.relatedTarget.id).offsetWidth/document.getElementById(event.target.id).offsetWidth);
					var column= event.target.id.slice(-1);
					
					if ($('#'+event.relatedTarget.id).hasClass('odd')){
						var middledivnum = parseInt(event.target.id.charAt(event.target.id.length-2));
						var divoneachsidenum = (length-1)/2;
						console.log(divoneachsidenum + ' : divs on each side');
						
						var startingdivnum = middledivnum - divoneachsidenum;
						console.log(startingdivnum + ' : starting div num')
						
						var endingdivnum = middledivnum + divoneachsidenum;
						console.log(endingdivnum + 'ending div num')
						
						for(i=startingdivnum; i<endingdivnum+1; i++){
							var d = document.getElementById('lsquare'+i+column);
							d.classList.add('occupied');
							d.classList.add('by'+event.relatedTarget.id);
							console.log('lsquare'+i+column);
						}
					}
					
					
						if ($('#'+event.relatedTarget.id).hasClass('even')){
							
						//console.log('boat middle: ' + ((document.getElementById(event.relatedTarget.id).getBoundingClientRect().left+document.getElementById(event.relatedTarget.id).getBoundingClientRect().right)/2));
						//console.log('cell right: ' +document.getElementById(event.target.id).getBoundingClientRect().right);
						//console.log('cell left: ' +document.getElementById(event.target.id).getBoundingClientRect().left);
						
						var boatcentery = (document.getElementById(event.relatedTarget.id).getBoundingClientRect().top+document.getElementById(event.relatedTarget.id).getBoundingClientRect().bottom)/2;
						console.log('boat center ' + boatcentery);
						var topcellbound = document.getElementById(event.target.id).getBoundingClientRect().top;
						console.log('top cell bound ' + topcellbound);
						var bottomcellbound = document.getElementById(event.target.id).getBoundingClientRect().bottom;
						console.log('bottom cell bound ' + bottomcellbound);
						
						if ( Math.round(boatcentery) > (Math.round(topcellbound)-2) && Math.round(boatcentery) < (Math.round(topcellbound)+2) ){
							var divsontop = ((length)/2);
							var divsonbottom = divsontop-1;	
						} else if ( Math.round(boatcentery) > (Math.round(bottomcellbound)-2) && Math.round(boatcentery) < (Math.round(bottomcellbound)+2)){
							var divsonbottom = ((length)/2);
							var divsontop = divsonbottom-1;	
						}
						
						var middledivnum = parseInt(event.target.id.charAt(event.target.id.length-2));
						console.log('middle div : ',middledivnum)
						//console.log(divsonrightside + ' : divs on right side');
						//console.log(divsonleftside + ' : divs on left side');
						
						var startingdivnum = middledivnum - divsontop;
						//console.log(startingdivnum + ' : starting div num');
						
						var endingdivnum = middledivnum + divsonbottom;
						//console.log(endingdivnum + 'ending div num')
						
						for(i=startingdivnum; i<endingdivnum+1; i++){
							var d = document.getElementById('lsquare'+i+column);
							d.classList.add('occupied');
							d.classList.add('by'+event.relatedTarget.id);
							//console.log('lsquare'+row+i);
						}
					}
				}
				
				
			  },
			  ondropdeactivate: function (event) {
				// remove active dropzone feedback
				event.target.classList.remove('drop-active');
				event.target.classList.remove('drop-target');
			  }
	});

// HTML GENERATION
var gridx = 8, gridy = 8;
var Ships = [["Minesweeper",2,4],["Frigate",3,4],[ "Cruiser",4,2],[ "Battleship",5,1]];

var player1Grid = [[]];
var player2Grid = [[]];
var player1Ships = [];

document.write("<div id=\"animated-background\" ></div>");
document.write("<p id=\"phase\" > place your ships! </p>");

// player 1 table
document.write("<div id='left' class='active'>");

/*document.write("<div id='shipdiv'>");
document.write("<div class ='odd horizontal ship cruiser draggable' id='ship1'></div>");
document.write("<div class ='odd rotation-trans horizontal ship carrier draggable' id='ship2'></div>");
document.write("<div class ='even rotation-trans horizontal ship battleship draggable' id='ship3'></div>");
document.write("<div class ='even rotation-trans horizontal ship destroyer draggable' id='ship4'></div>");
document.write("<div class ='odd rotation-trans horizontal ship submarine draggable'id='ship5'></div>");
document.write("</div>");
*/


//player 1 table
document.write("<div id='tableleft' class='table'>");
for (i=0; i<(gridx); i++)
{
	document.write("<div id='lrow" + i + "' class='row'>");
		for (j=0; j<gridy; j++)
		{
		document.write("<div id='lsquare" + i+''+j + "' class='square'>");
		document.write("</div>");
		}
	document.write("</div>");
}
document.write("</div></div>");

document.write("<div id='right' style='right:-30%;'>");
// player 2 table
document.write("<div id='tableright' class='table'>");
for (i=0; i<(gridx); i++)
{
	document.write("<div id='rrow" + i + "' class='row'>");
		for (j=0; j<gridy; j++)
		{
		document.write("<div id='rsquare" + i +''+ j + "' class='square'>");
		document.write("</div>");
		}
	document.write("</div>");
}
document.write("</div></div>");

document.write("<div id=\"rightarrow\">-></div>");
document.write("<div id=\"leftarrow\"><-</div>");


//peudo random ship placement
var div1 = document.getElementById('lsquare13');
div1.innerHTML = div1.innerHTML + "<div class ='odd rotation-trans horizontal ship cruiser draggable' id='ship1'></div>";
//peudo random ship placement
var div2 = document.getElementById('lsquare23');
div2.innerHTML = div2.innerHTML + "<div class ='odd rotation-trans horizontal ship carrier draggable' id='ship2'></div>";
//peudo random ship placement
var div3 = document.getElementById('lsquare33');
div3.innerHTML = div3.innerHTML + "<div class ='even rotation-trans horizontal ship battleship draggable' id='ship3'></div>";
//peudo random ship placement
var div4 = document.getElementById('lsquare43');
div4.innerHTML = div4.innerHTML + "<div class ='odd rotation-trans horizontal ship submarine draggable' id='ship4'></div>";
//peudo random ship placement
var div5 = document.getElementById('lsquare63');
div5.innerHTML = div5.innerHTML + "<div class ='even rotation-trans horizontal ship destroyer draggable' id='ship5'></div>";


document.write("<form action=\"http://www.html.am/html-codes/forms/html-form-tag-action.cfm\" target=\"chattextarea\" method=\"get\" id=\"chat\">");
document.write("<div id=\"chatdiv\">");
document.write("<input id=\"chatinput\" name=\"chatinput\" type=\"text\" value=\"\" form=\"chat\">");
document.write("<input type=\"submit\" id=\"chatbutton\" value=\"Send\">");
document.write("</form>");
document.write("<div id=\"chattextarea\" name=\"chattextarea\"></div>");
document.write("</div>");
</script>
<body>
</body>
</html>
